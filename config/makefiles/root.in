
## Setup some commands
PERL          = @perl@
RM_F          = @rm_f@
PARROT        = ../../parrot@exe@

all: types.pbc symtable.pbc read.pbc arcall.pbc compiler.pbc builtins.pbc arc.pbc

types.pbc: types.pir
	$(PARROT) -o types.pbc types.pir

symtable.pbc: symtable.pir
	$(PARROT) -o symtable.pbc symtable.pir

read.pbc: read.pir types_macros.pir
	$(PARROT) -o read.pbc read.pir

arcall.pbc: arcall.pir
	$(PARROT) -o arcall.pbc arcall.pir

compiler.pbc: compiler.pir
	$(PARROT) -o compiler.pbc compiler.pir

builtins.pbc: builtins.pir
	$(PARROT) -o builtins.pbc builtins.pir

arc.pbc: arc.pir
	$(PARROT) -o arc.pbc arc.pir

# regenerate the Makefile
Makefile: config/makefiles/root.in
	$(PERL) Configure.pl

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  all:               Compile all *.pbc"
	@echo "                     This is the default."
	@echo "Testing:"
	@echo "  test:              Run the test suite."
	@echo "  testclean:         Clean up test results."
	@echo ""
	@echo "Cleaning:"
	@echo "  clean:             Basic cleaning up."
	@echo "  realclean:         Removes also files generated by 'Configure.pl'"
	@echo "  distclean:         Removes also anything built, in theory"
	@echo ""
	@echo "Misc:"
	@echo "  help:              Print this help message."
	@echo ""

test: all
	$(PERL) t/harness

codetest: codetest-make codetest-perl codetest-pir

T_MAKE  = config//makefiles//root.in
T_PERL  = Configure.pl t//harness t//*.t lib//Parrot//Test//*.pm
T_PIR   = *.pir

codetest-make:
	- $(PERL) @build_dir@/t/codingstd/filenames.t $(T_MAKE)
	- $(PERL) @build_dir@/t/codingstd/make_code_coda.t $(T_MAKE)
	- $(PERL) @build_dir@/t/codingstd/linelength.t $(T_MAKE)
	- $(PERL) @build_dir@/t/codingstd/trailing_space.t $(T_MAKE)

codetest-perl:
	- $(PERL) @build_dir@/t/codingstd/cuddled_else.t $(T_PERL)
	- $(PERL) @build_dir@/t/codingstd/filenames.t $(T_PERL)
	- $(PERL) @build_dir@/t/codingstd/linelength.t $(T_PERL)
	- $(PERL) @build_dir@/t/codingstd/perlcritic.t $(T_PERL)
	- $(PERL) @build_dir@/t/codingstd/trailing_space.t $(T_PERL)

codetest-pir:
	- $(PERL) @build_dir@/t/codingstd/filenames.t $(T_PIR)
	- $(PERL) @build_dir@/t/codingstd/linelength.t $(T_PIR)
	- $(PERL) @build_dir@/t/codingstd/pir_code_coda.t $(T_PIR)
	- $(PERL) @build_dir@/t/codingstd/tabs.t $(T_PIR)
	- $(PERL) @build_dir@/t/codingstd/trailing_space.t $(T_PIR)

TEST_CLEANUPS = \
  "t/*.arc" \
  "t/*.out"

testclean:
	$(RM_F) $(TEST_CLEANUPS)

CLEANUPS = "*.pbc"

clean: testclean
	$(RM_F) $(CLEANUPS)

realclean: clean
	$(RM_F) Makefile

distclean: realclean

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:
